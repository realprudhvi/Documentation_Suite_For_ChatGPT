<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Chat Preview</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 850px; margin: 0 auto; padding: 40px; line-height: 1.6; }
        
        /* Themes */
        body.dark { background-color: #1e1e1e; color: #ececf1; }
        body.light { background-color: #ffffff; color: #333333; }
        
        /* Layout */
        .folder-title { border-bottom: 2px solid #555; padding-bottom: 10px; margin-top: 40px; font-weight: 600; }
        .response-wrapper { display: flex; gap: 15px; margin-bottom: 30px; border-bottom: 1px dashed #444; padding-bottom: 20px; }
        .response-number { min-width: 35px; text-align: right; font-weight: bold; opacity: 0.6; }
        .response-block { flex: 1; overflow-x: auto; }
        
        /* Cleanups */
        .section-selected-active { outline: none !important; background: none !important; }
        
        /* Tables & Images */
        table { border-collapse: collapse; width: 100%; margin: 15px 0; font-size: 14px; }
        th, td { border: 1px solid #777; padding: 8px 12px; }
        img { max-width: 100%; border-radius: 8px; border: 1px solid #555; }
        
        /* Code & Math */
        pre { background: transparent; padding: 0; }
        code.hljs { padding: 15px; border-radius: 6px; font-family: Consolas, monospace; border: 1px solid #444; }
    </style>
    
    <link id="hljs-theme" rel="stylesheet" href="">
</head>
<body class="light">
    <h1 id="page-title" style="text-align:center;">Chat Export</h1>
    <div id="content">Loading content...</div>

    <script>
        window.addEventListener('message', (event) => {
            const data = event.data;
            if (!data || !data.content) return;

            // 1. Set Content
            document.getElementById('page-title').innerText = data.title;
            document.getElementById('content').innerHTML = data.content;
            
            // 2. Set Theme
            document.body.className = data.isDark ? 'dark' : 'light';
            
            const themeUrl = data.isDark 
                ? "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" 
                : "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css";
            document.getElementById('hljs-theme').href = themeUrl;

            // 3. Render Math & Code (with slight delay to ensure DOM is ready)
            setTimeout(() => {
                if (window.renderMathInElement) {
                    renderMathInElement(document.body, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false},
                            {left: '\\(', right: '\\)', display: false},
                            {left: '\\[', right: '\\]', display: true}
                        ]
                    });
                }
                if (window.hljs) hljs.highlightAll();
            }, 50);
        });
    </script>
</body>
</html>